import{_ as I,r as f,o as i,c,a as g,d as e,F as b,f as v,g as V,t as d,b as n,w as k,h as x,v as P,n as p,i as E}from"./index-704af0ed.js";const{VITE_APP_URL:m,VITE_APP_PATH:u}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"jenny7532",BASE_URL:"/vue-week6/",MODE:"production",DEV:!1,PROD:!0},U={data(){return{products:[],productId:"",cart:{},loadingItem:"",form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1}},methods:{getCarts(){this.$http.get(`${m}api/${u}/cart`).then(l=>{this.cart=l.data.data}).catch(l=>{alert(l.response.data.message)})},updataCartItem(l){const a={product_id:l.product.id,qty:l.qty};this.loadingItem=l.id,this.$http.put(`${m}api/${u}/cart/${l.id}`,{data:a}).then(y=>{this.getCarts(),this.loadingItem="",alert("該產品數量調整成功!")}).catch(()=>{alert("該產品數量調整失敗!!")})},deleteItem(l){this.loadingItem=l.id,this.$http.delete(`${m}api/${u}/cart/${l.id}`).then(a=>{this.getCarts(),this.loadingItem="",alert("購物車已移除該品項!")}).catch(()=>{alert("購物車移除該品項失敗!!")})},deleteCarts(){this.loadingItem="delete",this.$http.delete(`${m}api/${u}/carts`).then(l=>{this.getCarts(),alert("購物車已清空!"),this.loadingItem=""}).catch(()=>{alert("購物車清空失敗!!")})},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"需填入正確的手機號碼格式"},submitOrder(){const l=this.form;this.cart.carts.length===0?alert("購物車請加入商品後執行"):this.$http.post(`${m}api/${u}/order`,{data:l}).then(a=>{alert("訂單提交成功!"),this.$refs.form.resetForm(),this.form.message="",this.getCarts()}).catch(()=>{alert("訂單提交失敗，請聯繫客服人員!!")})}},mounted(){this.getCarts()}},w={class:"text-end"},T=["disabled"],q={class:"table align-middle"},A=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1),N=["onClick","disabled"],D={key:0,class:"fas fa-spinner fa-pulse"},L={class:"input-group input-group-sm"},S={class:"input-group mb-3"},B=["onUpdate:modelValue","onChange","disabled"],O=["value"],R={class:"input-group-text",id:"basic-addon2"},F=e("td",{colspan:"4",class:"text-end"},"總計",-1),M={class:"text-end"},j=e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),H={class:"text-end text-success"},$={class:"my-5 row justify-content-center"},z={class:"mb-3"},G=e("label",{for:"email",class:"form-label"},"Email",-1),J={class:"mb-3"},K=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Q={class:"mb-3"},W=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),X={class:"mb-3"},Y=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Z={class:"mb-3"},ee=e("label",{for:"message",class:"form-label"},"留言",-1),te=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function se(l,a,y,le,s,r){const h=f("v-field"),_=f("error-message"),C=f("v-form");return i(),c(b,null,[g(" 這是購物車頁面 "),e("div",w,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:s.loadingItem==="delete",onClick:a[0]||(a[0]=(...t)=>r.deleteCarts&&r.deleteCarts(...t))},"清空購物車",8,T)]),e("table",q,[A,e("tbody",null,[s.cart.carts?(i(!0),c(b,{key:0},v(s.cart.carts,t=>(i(),c("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>r.deleteItem(t),disabled:t.id===s.loadingItem},[s.loadingItem===t.id?(i(),c("i",D)):V("",!0),g(" x ")],8,N)]),e("td",null,d(t.product.title)+" ",1),e("td",null,[e("div",L,[e("div",S,[x(e("select",{name:"",id:"",class:"from-select","onUpdate:modelValue":o=>t.qty=o,onChange:o=>r.updataCartItem(t),disabled:t.id===s.loadingItem},[(i(),c(b,null,v(20,o=>e("option",{value:o,key:`${o}+123`},d(o),9,O)),64))],40,B),[[P,t.qty]]),e("span",R,d(t.product.unit),1)])])]),e("td",null,d(t.product.price),1),e("td",null,d(t.total),1)]))),128)):V("",!0)]),e("tfoot",null,[e("tr",null,[F,e("td",M,d(s.cart.total),1)]),e("tr",null,[j,e("td",H,d(s.cart.final_total),1)])])]),e("div",$,[n(C,{ref:"form",class:"col-md-6",onSubmit:r.submitOrder},{default:k(({errors:t})=>[e("div",z,[G,n(h,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":a[1]||(a[1]=o=>s.form.user.email=o)},null,8,["class","modelValue"]),n(_,{name:"email",class:"invalid-feedback"})]),e("div",J,[K,n(h,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":a[2]||(a[2]=o=>s.form.user.name=o)},null,8,["class","modelValue"]),n(_,{name:"姓名",class:"invalid-feedback"})]),e("div",Q,[W,n(h,{id:"tel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入手機號碼格式",rules:r.isPhone,modelValue:s.form.user.tel,"onUpdate:modelValue":a[3]||(a[3]=o=>s.form.user.tel=o)},null,8,["class","rules","modelValue"]),n(_,{name:"電話",class:"invalid-feedback"})]),e("div",X,[Y,n(h,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":a[4]||(a[4]=o=>s.form.user.address=o)},null,8,["class","modelValue"]),n(_,{name:"地址",class:"invalid-feedback"})]),e("div",Z,[ee,x(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":a[5]||(a[5]=o=>s.form.message=o)},null,512),[[E,s.form.message]])]),te]),_:1},8,["onSubmit"])])],64)}const oe=I(U,[["render",se]]);export{oe as default};
